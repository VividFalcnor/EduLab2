<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EduLab - Virtual Science Experiments</title>
  <style>
    body { background-color: #eef3fb; font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    .experiment-grid { display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin-top: 30px; }
    .experiment { width: 200px; height: 180px; background-color: #fff; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 15px; cursor: pointer; transition: transform 0.3s ease; }
    .experiment:hover { transform: scale(1.05); }
    .experiment img { margin-bottom: 10px; }
    .experiment h3 { margin: 5px 0; }
    .experiment p { margin: 0; color: #666; }
    .hidden { display: none; }
    model-viewer { width: 45%; height: 300px; background-color: #fff; margin: 0 10px; }
    #titrationCanvas { border: 1px solid #ccc; background-color: #fff; margin: 20px auto; display: block; }
    .bar-container { width: 400px; height: 20px; background-color: #ddd; margin: 20px auto; position: relative; }
    .bar { height: 100%; width: 0; background-color: #76c7c0; transition: width 0.1s; }
    .target-zone { position: absolute; height: 100%; background-color: rgba(255,215,0,0.5); left: 40%; width: 20%; pointer-events: none; }
    #status { font-size: 18px; margin-top: 10px; }
    #infoBox { font-size: 14px; color: #333; margin: 20px 0; }
    .labels { margin: 10px 0; font-size: 14px; }
    .center-3d { display: flex; justify-content: center; align-items: center; margin-top: 20px; }
    .button { margin: 10px; padding: 10px 20px; font-size: 16px; border: none; border-radius: 6px; background-color: #4285f4; color: #fff; cursor: pointer; }
  </style>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>
  <h1>Welcome to EduLab</h1>
  <p>Select an experiment to explore:</p>
  <div class="experiment-grid">
    <div class="experiment" onclick="showTitration()">
      <img src="titration.png" alt="Titration" width="60" height="60" onerror="this.src='fallback.png';">
      <h3>Titration</h3>
      <p>Click to explore</p>
    </div>
    <div class="experiment">
      <img src="projectile_motion.png" alt="Projectile Motion" width="60" height="60" onerror="this.src='fallback.png';">
      <h3>Projectile Motion</h3>
      <p>Coming Soon</p>
    </div>
    <div class="experiment">
      <img src="acid_base.png" alt="Acid Base" width="60" height="60" onerror="this.src='fallback.png';">
      <h3>Acid Base</h3>
      <p>Coming Soon</p>
    </div>
    <div class="experiment">
      <img src="electrolysis.png" alt="Electrolysis" width="60" height="60" onerror="this.src='fallback.png';">
      <h3>Electrolysis</h3>
      <p>Coming Soon</p>
    </div>
  </div>

  <div id="titrationSection" class="hidden">
    <h2>Titration Experiment</h2>
    <div class="center-3d">
      <model-viewer src="burette.glb" alt="3D Burette" camera-controls auto-rotate></model-viewer>
      <model-viewer src="conical_flask.glb" alt="3D Flask" camera-controls auto-rotate></model-viewer>
    </div>
    <div class="labels">Burette (HCl solution) | Flask (NaOH with indicator)</div>
    <div id="infoBox">Use SPACE within the yellow zone for 5â€“8s to titrate. Hold too long = failure.</div>
    <canvas id="titrationCanvas" width="400" height="300"></canvas>
    <div class="bar-container">
      <div id="inputBar" class="bar"></div>
      <div class="target-zone"></div>
    </div>
    <p id="status"></p>
    <button id="retryBtn" class="button hidden" onclick="resetExperiment()">Repeat Experiment</button>
  </div>

  <script>
    const titrationSection = document.getElementById('titrationSection');
    const canvas = document.getElementById('titrationCanvas');
    const ctx = canvas.getContext('2d');
    const inputBar = document.getElementById('inputBar');
    const status = document.getElementById('status');
    const retryBtn = document.getElementById('retryBtn');

    let flaskLevel, buretteLevel, barValue, isPressing, lastAdd, holdTime, flaskColor, experimentDone;

    function showTitration() {
      titrationSection.classList.remove('hidden');
      document.querySelector('.experiment-grid').classList.add('hidden');
      resetExperiment();
    }

    function resetExperiment() {
      flaskLevel = 80;
      buretteLevel = 100;
      barValue = 0;
      isPressing = false;
      lastAdd = 0;
      holdTime = 0;
      flaskColor = '#aecbfa';
      experimentDone = false;
      retryBtn.classList.add('hidden');
      status.textContent = '';
      draw();
    }

    document.body.addEventListener('keydown', e => {
      if (e.code === 'Space') isPressing = true;
    });

    document.body.addEventListener('keyup', e => {
      if (e.code === 'Space') isPressing = false;
    });

    function draw() {
      ctx.clearRect(0, 0, 400, 300);

      // draw burette
      ctx.fillStyle = '#555';
      ctx.fillRect(190, 20, 20, 200);
      ctx.fillStyle = '#f28b82';
      let bh = (buretteLevel / 100) * 200;
      ctx.fillRect(190, 20 + (200 - bh), 20, bh);

      // draw flask
      ctx.strokeStyle = '#000';
      ctx.beginPath();
      ctx.moveTo(160, 260); ctx.lineTo(180, 300); ctx.lineTo(220, 300); ctx.lineTo(240, 260);
      ctx.quadraticCurveTo(200, 240, 160, 260);
      ctx.stroke();
      let fh = (flaskLevel / 100) * 40;
      ctx.fillStyle = flaskColor;
      ctx.beginPath();
      ctx.moveTo(180, 300); ctx.lineTo(220, 300); ctx.lineTo(220, 300 - fh); ctx.lineTo(180, 300 - fh); ctx.closePath();
      ctx.fill();
    }

    function update() {
      if (experimentDone) return;

      barValue = isPressing ? Math.min(100, barValue + 1) : Math.max(0, barValue - 0.5);
      inputBar.style.width = barValue + '%';
      const now = Date.now();

      if (barValue >= 40 && barValue <= 60 && now - lastAdd > 100) {
        if (buretteLevel > 0 && flaskLevel < 100) {
          buretteLevel -= 0.5;
          flaskLevel += 0.5;
          holdTime += 0.1;
          lastAdd = now;
        }
        status.textContent = `Holding... ${holdTime.toFixed(1)}s`;
        if (holdTime >= 5 && holdTime <= 8) {
          flaskColor = '#dab6f7';
          status.textContent = 'Titration successful! Endpoint reached.';
          experimentDone = true;
        } else if (holdTime > 8) {
          flaskColor = '#6a0dad';
          status.textContent = 'Titration failed. Overshot endpoint.';
          retryBtn.classList.remove('hidden');
          experimentDone = true;
        }
      } else if (barValue > 60) {
        status.textContent = 'Flow too fast! Slow down.';
      } else if (barValue < 40) {
        status.textContent = 'Flow too slow. Increase speed.';
      }
      draw();
      requestAnimationFrame(update);
    }

    draw();
    update();
  </script>
</body>
</html>
