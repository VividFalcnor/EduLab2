<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EduLab - Virtual Titration Experiment</title>
  <style>
    body { background-color: #eef3fb; font-family: Trebuchet MS, sans-serif; text-align: center; padding: 20px; }
    #experimentMenu { margin-bottom: 30px; }
    #titrationSection { display: none; }
    .bar-container { width: 400px; height: 20px; background-color: #ddd; margin: 20px auto; position: relative; }
    .bar { height: 100%; width: 0; background-color: #76c7c0; transition: width 0.1s; }
    .target-zone { position: absolute; height: 100%; background-color: rgba(255,215,0,0.5); left: 40%; width: 20%; pointer-events: none; }
    #status { font-size: 18px; margin-top: 10px; }
    canvas { background-color: #fff; border: 1px solid #ccc; margin-top: 20px; }
    button { margin-top: 15px; padding: 10px 20px; font-size: 16px; border: none; border-radius: 6px; background-color: #4285f4; color: #fff; cursor: pointer; }
    #infoBox, .pin { font-size: 14px; color: #333; margin: 10px; }
    .pin { background: #ffcc00; padding: 5px; border-radius: 4px; display: inline-block; }
    #titrationInfo { margin-top: 20px; font-size: 15px; padding: 10px; background: #fff3cd; border-left: 6px solid #ffeeba; display: none; }
    #logo { position: absolute; top: 10px; left: 10px; height: 50px; }
  </style>
</head>
<body>
  <img src="Brand Logo.png" width="606" height="370" onerror="this.src='fallback.png'">
  <h1>EduLab - Virtual Titration</h1>
  <h2>No Equipment? No Problem.</h2>

  <div id="experimentMenu">
    <p>Select an experiment to explore:</p>
    <button onclick="startTitration()">Start Titration Experiment</button>
      <img src="Titration.png" alt="Titration" width="60" height="60" onerror="this.src='fallback.png'">
      <h3>Titration</h3>
    </div>
    <div class="experiment">
      <img src="Projectile Motion.png" alt="Projectile Motion" width="60" height="60" onerror="this.src='fallback.png'">
      <h3>Projectile Motion</h3>
      <p>Coming Soon</p>
    </div>
    <div class="experiment">
      <img src="Acid Base.png" alt="Acid Base" width="60" height="60" onerror="this.src='fallback.png'">
      <h3>Acid Base</h3>
      <p>Coming Soon</p>
    </div>
    <div class="experiment">
      <img src="Electrolysis.png" alt="Electrolysis" width="60" height="60" onerror="this.src='fallback.png'">
      <h3>Electrolysis</h3>
      <p>Coming Soon</p>
    </div>
  </div>
  

  <div id="titrationSection">
    <h2>Titration Experiment</h2>
    <canvas id="titrationCanvas" width="400" height="300"></canvas>
    <div class="bar-container">
      <div id="inputBar" class="bar"></div>
      <div class="target-zone"></div>
    </div>
    <p>Hold SPACE to pour within the yellow zone</p>
    <p id="status"></p>
    <button id="repeatBtn" onclick="resetExperiment()" style="display:none;">Repeat Experiment</button>
    <button onclick="returnToMenu()">Return to Experiments Menu</button>
    <button onclick="toggleTitrationInfo()">What is Titration?</button>
    <div id="titrationInfo">
      Titration is a technique where a solution of known concentration is used to determine the concentration of an unknown solution. The goal is to identify the exact point where neutralization occurs, often indicated by a color change.
    </div>
    <div id="infoBox">
      <span class="pin">Burette: Contains NaOH (Sodium Hydroxide)</span>
      <span class="pin">Flask: Contains HCl (Hydrochloric Acid) with indicator</span>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('titrationCanvas');
    const ctx = canvas.getContext('2d');
    const inputBar = document.getElementById('inputBar');
    const status = document.getElementById('status');
    let flaskLevel = 80, buretteLevel = 100, barValue = 0, isPressing = false, lastAdd = 0;
    let pourDuration = 0;
    let completed = false;

    document.body.addEventListener('keydown', e => { if (e.code === 'Space') isPressing = true; });
    document.body.addEventListener('keyup', e => { if (e.code === 'Space') isPressing = false; });

    function draw() {
      ctx.clearRect(0, 0, 400, 300);
      // Draw detailed burette
      ctx.fillStyle = '#555';
      ctx.fillRect(180, 10, 40, 210); // outer case
      ctx.fillStyle = '#f28b82';
      const bh = (buretteLevel / 100) * 200;
      ctx.fillRect(185, 15 + (200 - bh), 30, bh); // liquid level
      ctx.strokeStyle = '#000';
      ctx.strokeRect(180, 10, 40, 210);
      ctx.fillStyle = '#000';
      ctx.fillText("Burette", 170, 8);

      // Draw detailed flask
      ctx.beginPath();
      ctx.moveTo(150, 260); ctx.lineTo(170, 300);
      ctx.lineTo(230, 300); ctx.lineTo(250, 260);
      ctx.quadraticCurveTo(200, 250, 150, 260);
      ctx.stroke();
      ctx.fillStyle = completed ? '#7CFC00' : '#aecbfa';
      const fh = (flaskLevel / 100) * 40;
      ctx.beginPath();
      ctx.moveTo(170, 300); ctx.lineTo(230, 300);
      ctx.lineTo(230, 300 - fh); ctx.lineTo(170, 300 - fh);
      ctx.closePath();
      ctx.fill();
      ctx.fillStyle = '#000';
      ctx.fillText("Flask", 190, 290);
    }

    function update() {
      if (completed) return;

      barValue = isPressing ? Math.min(100, barValue + 1) : Math.max(0, barValue - 0.5);
      inputBar.style.width = barValue + '%';

      const now = Date.now();
      if (barValue >= 40 && barValue <= 60 && now - lastAdd > 500) {
        if (buretteLevel > 0 && flaskLevel < 100) {
          buretteLevel -= 2;
          flaskLevel += 2;
          lastAdd = now;
          pourDuration += 0.5;
          status.textContent = 'Titrant added.';
        }
      } else if (barValue > 60 && isPressing) {
        status.textContent = 'Flow too fast! Slow down.';
        pourDuration = 0;
      } else if (barValue < 40 && isPressing) {
        status.textContent = 'Flow too slow. Increase speed.';
        pourDuration = 0;
      }

      if (pourDuration >= 4 && !completed) {
        completed = true;
        status.textContent = 'Titration complete!';
        document.getElementById('repeatBtn').style.display = 'inline-block';
        draw();
        return;
      }

      draw();
      requestAnimationFrame(update);
    }

    function startTitration() {
      document.getElementById('experimentMenu').style.display = 'none';
      document.getElementById('titrationSection').style.display = 'block';
      draw();
      update();
    }

    function resetExperiment() {
      flaskLevel = 80;
      buretteLevel = 100;
      barValue = 0;
      pourDuration = 0;
      completed = false;
      status.textContent = '';
      document.getElementById('repeatBtn').style.display = 'none';
      draw();
      update();
    }

    function returnToMenu() {
      document.getElementById('titrationSection').style.display = 'none';
      document.getElementById('experimentMenu').style.display = 'block';
    }

    function toggleTitrationInfo() {
      const info = document.getElementById('titrationInfo');
      info.style.display = info.style.display === 'block' ? 'none' : 'block';
    }
  </script>
</body>
</html>
