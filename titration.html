<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Titration Experiment - EduLab</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #eef3fb;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    .model-section {
      margin-top: 40px;
    }
    .model-viewer {
      width: 300px;
      height: 300px;
      margin: 10px;
    }
    .button-scroll {
      margin: 20px;
      padding: 10px 20px;
      font-size: 16px;
    }
    .exp-title {
      margin-top: 50px;
      font-size: 28px;
      font-weight: bold;
    }
    #titration2D {
      margin-top: 40px;
    }
    canvas, #barContainer {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Titration Equipment Preview</h1>
  <div class="model-section">
    <model-viewer src="burette.glb" alt="3D Burette" auto-rotate camera-controls class="model-viewer"></model-viewer>
    <model-viewer src="conical_flask.glb" alt="3D Conical Flask" auto-rotate camera-controls class="model-viewer"></model-viewer>
  </div>

  <button class="button-scroll" onclick="document.getElementById('titration2D').scrollIntoView({ behavior: 'smooth' })">
    Run the Experiment
  </button>

  <div id="titration2D">
    <h2 class="exp-title">2D Titration Simulation</h2>

    <p><strong>Flask contains:</strong> HCl (Hydrochloric Acid) ðŸ”µ</p>
    <p><strong>Burette contains:</strong> NaOH (Sodium Hydroxide) ðŸ”´</p>

    <canvas id="canvas" width="300" height="300" style="border:1px solid black;"></canvas>

    <div id="barContainer" style="width: 300px; height: 20px; border: 1px solid #333; margin: 20px auto;">
      <div id="bar" style="height: 100%; width: 0%; background-color: green;"></div>
    </div>

    <p>Press SPACE to control the flow rate. Stay within the range to proceed!</p>
    <p id="status"></p>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const flask = { x: 120, y: 150, w: 60, h: 100 };
    const burette = { x: 135, y: 10, w: 30, h: 140 };
    let dropY = 20;
    let isDropping = false;

    const bar = document.getElementById('bar');
    const status = document.getElementById('status');
    let barValue = 0;

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Draw burette
      ctx.fillStyle = 'red';
      ctx.fillRect(burette.x, burette.y, burette.w, burette.h);

      // Draw flask
      ctx.fillStyle = 'blue';
      ctx.beginPath();
      ctx.moveTo(flask.x, flask.y);
      ctx.lineTo(flask.x + flask.w, flask.y);
      ctx.lineTo(flask.x + flask.w - 10, flask.y + flask.h);
      ctx.lineTo(flask.x + 10, flask.y + flask.h);
      ctx.closePath();
      ctx.fill();

      // Droplet
      if (isDropping) {
        ctx.beginPath();
        ctx.arc(burette.x + burette.w / 2, dropY, 5, 0, Math.PI * 2);
        ctx.fillStyle = 'purple';
        ctx.fill();
        dropY += 2;
        if (dropY > flask.y + 10) {
          dropY = 20;
          isDropping = false;
        }
      }

      requestAnimationFrame(draw);
    }

    draw();

    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        barValue = Math.min(barValue + 2, 100);
        isDropping = true;
      }
    });

    setInterval(() => {
      barValue = Math.max(barValue - 1, 0);
      bar.style.width = `${barValue}%`;

      if (barValue > 60 && barValue < 80) {
        status.textContent = "Titration in progress...";
        status.style.color = "green";
      } else if (barValue <= 60) {
        status.textContent = "Too slow! Try again.";
        status.style.color = "orange";
      } else {
        status.textContent = "Too fast! Titration failed.";
        status.style.color = "red";
      }
    }, 200);
  </script>
</body>
</html>
